#! /bin/sh

# Panel config for LemonBoy's bar
# Reads lines from /tmp/panel-fifo

while read -r line ; do
    case $line in
        B*)
            # battery output
            bat="${line#?}"
            stus=$(echo $bat | cut -d ' ' -f1)
            bat="$(echo $bat | cut -d ' ' -f2)%"
            if [ $stus == "Charging" ] || [ $stus == "Full" ] || [ $stus == "Unknown" ] ; then
                # plugged in
                bat="  \\f2$bat\\fr"
            else
                # discharging
                case $bat in
                           100%) bat="  \\f2$bat\\fr" ;; # full
                    [8-9][0-9]%) bat="  \\f2$bat\\fr" ;;
                    [5-7][0-9]%) bat="  \\f2$bat\\fr" ;; # emptying
                    [2-4][0-9]%) bat="  \\f2$bat\\fr" ;; # draining
                        1[6-9]%) bat="  \\f2$bat\\fr" ;;
                        1[0-5]%) bat="  \\f3$bat\\fr" ;; # critical
                         [0-9]%) bat="  \\f3$bat\\fr" ;;
                esac
            fi
            ;;
	    G*)
            # essid output
	        wifi="\\f2${line#?}\\fr  "
	        ;;
        S*)
            # clock output
            clock="${line#?}"
            ;;
        V*)
            # volume output
            vol="${line#?}"
            perc="$(echo $vol | cut -d ' ' -f2)%"
            # check if muted
            if [ $(echo $vol | cut -d ' ' -f1) == "1" ] ; then
                case $perc in
                           100%) vol="  \\f2$perc\\fr" ;;
                    [5-9][0-9]%) vol="  \\f2$perc\\fr" ;;
                    [1-4][0-9]%) vol="  \\f2$perc\\fr" ;;
                         [0-9]%) vol="  \\f2$perc\\fr" ;;
                esac
            else
                vol="  \\f2$perc\\fr"
            fi
            ;;
        W*)
            # bspwm internal state
            wm_infos=""
            IFS=':'
            set -- ${line#?}
            while [ $# -gt 0 ] ; do
                item=$1
                case $item in
                    O*) wm_infos="$wm_infos\\u1 \\f6\\fr \\ur" ;; # focused occupied desktop
                    F*) wm_infos="$wm_infos\\u1 \\f6\\fr \\ur" ;; # focused free desktop
                    U*) wm_infos="$wm_infos\\u1\\b4 \\f8\\fr \\br\\ur" ;; # focused urgent desktop
                    o*) wm_infos="$wm_infos \\f6\\fr " ;; # occupied desktop
                    f*) wm_infos="$wm_infos \\f8\\fr " ;; # free inactive desktop
                    u*) wm_infos="$wm_infos\\b4 \\f8\\fr \\br" ;; # urgent desktop
                esac
                shift
            done
            ;;
    esac
    # bring it all together
    left=" $vol $bat"
    middle="$clock  "
    right="$wifi "
    # and print to bar
    printf "%s\n" "$left\\c$middle\\r$right"
done

